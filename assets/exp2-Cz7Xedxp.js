var D=Object.defineProperty;var O=(c,s,e)=>s in c?D(c,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[s]=e;var h=(c,s,e)=>O(c,typeof s!="symbol"?s+"":s,e);import{u as k,J as m,_ as f,a as q,f as B,S as C,p as H,I,d as T,H as E,E as M,c as N}from"./index-Coc0i56b.js";import{d as $,g as J,j as V,$ as X,a as y,o as b,b as p,t as Y,e as w,u as g,h as a,a0 as K}from"./vendor-C0OfONeZ.js";import{E as j}from"./EnterFullScreen-CMkwcFAG.js";class L{constructor(s,e){h(this,"loader",k());h(this,"bgs",[]);h(this,"bgs_len");h(this,"player");h(this,"can_move",!1);h(this,"dx",0);h(this,"dy",0);this.bgs_len=s.length;const i=s.map(t=>this.loadImg(this.loader.getAssets(t)));Promise.all(i).then(t=>{t.forEach(n=>{const r=new F({size:{width:128,height:128},pos:{x:0,y:0}});r.instance=n,this.bgs.push(r)})}),this.loadImg(this.loader.getAssets(e)).then(t=>{const r=new F({size:{width:t.width/10,height:t.height/10},pos:{x:0,y:0}});r.instance=t,this.player=r})}waitForReady(){return new Promise(s=>{const e=()=>{this.isReady?s():setTimeout(e,0)};e()})}get isFinish(){return!this.can_move}get isReady(){return this.bgs.length==this.bgs_len&&this.player!=null}reset(s,e){if(!this.player)return;const i=Math.min(s,e),t=s>e,{width:n,height:r}=this.player.size;this.player.size={width:(t?.15:.2)*i*(n>r?n/r:1),height:(t?.15:.2)*i*(n>r?1:r/n)};const o=50;this.bgs.forEach((l,u)=>{const{width:_,height:v}=l.rsize;switch(l.size={width:(t?.2:.25)*i*(_>v?_/v:1),height:(t?.2:.25)*i*(_>v?1:v/_)},u){case 0:l.pos={x:0+o,y:0+o};break;case 1:l.pos={x:s-this.bgs[1].size.width-o,y:0+o};break;case 2:l.pos={x:0+o,y:e-this.bgs[2].size.height-o};break;case 3:l.pos={x:s-this.bgs[1].size.width-o,y:e-this.bgs[2].size.height-o};break}}),this.player.pos={x:s/2-this.player.size.width/2,y:e-this.player.size.height-o},this.can_move=!0}draw(s){const{width:e,height:i}=s.canvas;s.clearRect(0,0,e,i),this.bgs.forEach(t=>t.draw(s)),this.player&&this.player.draw(s)}loadImg(s){return new Promise((e,i)=>{const t=new Image;t.onload=()=>e(t),t.onerror=i,t.src=s})}getValidFocusObj(s,e){if(this.player&&this.player.isFocus(s,e))return this.dx=s-this.player.pos.x,this.dy=e-this.player.pos.y,this.player}moveValidObj(s,e){!this.player||!this.can_move||(this.player.pos={x:s-this.dx,y:e-this.dy})}judge(s,e){return new Promise(i=>{this.bgs.forEach((t,n)=>{s>t.pos.x&&s<t.pos.x+t.size.width&&e>t.pos.y&&e<t.pos.y+t.size.height&&(this.can_move=!1,i(n))}),i(-1)})}}class F{constructor(s){h(this,"instance");h(this,"size");h(this,"pos");this.instance=document.createElement("img"),this.size=s.size,this.pos=s.pos}get rsize(){return{width:this.instance.width,height:this.instance.height}}set posX(s){this.pos.x=s}set posY(s){this.pos.y=s}draw(s){s&&s.drawImage(this.instance,0,0,this.rsize.width,this.rsize.height,this.pos.x,this.pos.y,this.size.width,this.size.height)}isFocus(s,e){return s>this.pos.x&&s<this.pos.x+this.size.width&&e>this.pos.y&&e<this.pos.y+this.size.height}}const U=$({__name:"DragPage",props:{mid:{type:String,default:"m1"},bgs:{type:Array,default:["b_happy","b_angry"]}},setup(c){const s=c,e=new L(s.bgs,s.mid),i={trial_type:"drag-core",start_time:m.instance.currTime,end_time:-1,move_start_time:-1,move_end_time:-1,response:"",cursors:[],c_picture:s.mid,c_picture_bgs:s.bgs},t=J();V(async()=>{t.value.width=window.innerWidth,t.value.height=window.innerHeight;const u=t.value.getContext("2d");u&&(await e.waitForReady(),e.reset(t.value.width,t.value.height),i.start_time=m.instance.currTime,r(u))}),X(()=>{n=!1});let n=!0;function r(u){n&&(e.draw(u),requestAnimationFrame(()=>r(u)))}const o=u=>{const{type:_,offsetX:v,offsetY:R}=u,[A,z]=[v,R];console.log(_,u);const x=m.instance.currTime;switch(_){case"pointerdown":if(i.move_start_time===-1&&(i.move_start_time=x),t.value.dataset.drag==="stop"||e.getValidFocusObj(A,z)==null)return;t.value.dataset.drag="dragging";break;case"pointerup":if(t.value.dataset.drag==="stop")return;i.move_end_time=x,t.value.dataset.drag="release";break;case"pointermove":if(t.value.dataset.drag!=="dragging")return;e.moveValidObj(A,z),i.end_time=x,i.cursors.push([A,z,e.dx,e.dy,t.value.width,t.value.height,x]),e.judge(A,z).then(S=>{S!==-1&&(i.move_end_time=x,t.value.dataset.drag="stop",l(S))});break}},l=u=>{i.response=s.bgs[u],m.plugin.timer.setTimeout(()=>{m.instance.currTrial.finish(i)},1e3)};return(u,_)=>(b(),y("canvas",{ref_key:"dom",ref:t,onPointermove:o,onPointerdown:o,onPointerup:o},null,544))}}),P=f(U,[["__scopeId","data-v-f85f0f1f"]]),W={};function G(c,s){return b(),y("div",null,[...s[0]||(s[0]=[p("p",null,"接下来你将看到一些不同的“房子”，每个房子代表一种情绪类型。",-1),p("p",null,"你会依次看到一系列人物面孔，请根据他们的表情，把每个人拖拽到你认为最符合的情绪房子里。",-1),p("p",null,"如果你不确定，可以根据你的第一感觉选择。",-1),p("p",null,"请尽量保持专注并按自己的节奏完成任务，不需要着急。",-1),p("p",null,"明白后，请点击“下一步”按钮，进入任务。",-1)])])}const Q=f(W,[["render",G]]),Z=["src"],ss={style:{"text-align":"center"}},es=["src"],ts=$({__name:"Instruct_detail",props:{img1:{type:String,default:""},img2:{type:String,default:""},desc:{type:String,default:""}},setup(c){const s=c;return(e,i)=>(b(),y("div",null,[p("img",{class:"bg",src:s.img1,alt:""},null,8,Z),p("p",ss,Y(s.desc),1),p("img",{class:"face",src:s.img2,alt:""},null,8,es)]))}}),d=f(ts,[["__scopeId","data-v-786ae7eb"]]),is={class:"box"},ns=$({__name:"Instruct_all_display",setup(c){const s=k();return(e,i)=>(b(),y("div",is,[w(d,{img1:g(s).getAssets("b_happy"),img2:g(s).getAssets("h1-happy"),desc:"快乐"},null,8,["img1","img2"]),w(d,{img1:g(s).getAssets("b_sad"),img2:g(s).getAssets("h1-sad"),desc:"悲伤"},null,8,["img1","img2"]),w(d,{img1:g(s).getAssets("b_fear"),img2:g(s).getAssets("h1-fear"),desc:"恐惧"},null,8,["img1","img2"]),w(d,{img1:g(s).getAssets("b_disgust"),img2:g(s).getAssets("h1-disgust"),desc:"厌恶"},null,8,["img1","img2"]),w(d,{img1:g(s).getAssets("b_angry"),img2:g(s).getAssets("h1-angry"),desc:"愤怒"},null,8,["img1","img2"]),w(d,{img1:g(s).getAssets("b_surprise"),img2:g(s).getAssets("h1-surprise"),desc:"惊讶"},null,8,["img1","img2"])]))}}),rs=f(ns,[["__scopeId","data-v-5c45ca8b"]]),as={};function os(c,s){return b(),y("div",null,[...s[0]||(s[0]=[p("p",null,"接下来是练习环节。在这里，你可以练习如何将人物面孔拖动到你认为合适的情绪房子里。练习不计入正式成绩，只是帮助你熟悉操作方式。",-1),p("p",null,"请注意，仅当您在练习环节中全部作答正确后，系统才会自动进入正式测试。如果出现答错的情况，系统将提示您重新作答，直到所有题目均回答正确为止。",-1),p("p",null,"在每一道练习题结束后，系统会即时反馈您的选择是否正确。如有任何不清楚之处，请随时向实验员咨询。",-1),p("p",null,"请您认真完成每一道练习题，无需紧张，只需按照提示逐步操作即可。",-1),p("p",null,"如已理解以上说明，请点击“开始练习”按钮。",-1)])])}const cs=f(as,[["render",os]]),ps={};function ls(c,s){return b(),y("div",null,[...s[0]||(s[0]=[p("p",null,"练习环节已全部通过！",-1),p("p",null,"接下来将进入正式测试。正式测试不再提供即时反馈请根据下方人物的表情，将其拖动到您认为最为相似的上方人物下方。本阶段不再显示正确或错误提示。请您尽量保持专注，独立完成所有题目。",-1),p("p",null,"请点击【开始】进入下一步。",-1)])])}const us=f(ps,[["render",ls]]),gs={id:"exp"},ds=$({__name:"exp2",setup(c){m.opts={...m.opts,iti:0,toastClose:!0};const s=m.instance,e=[],i=k();e.push({component:a(q,{assets:[...B,["b_happy","./assets/imgs/happy.png"],["b_sad","./assets/imgs/sad.png"],["b_fear","./assets/imgs/fear.png"],["b_angry","./assets/imgs/angry.png"],["b_surprise","./assets/imgs/surprise.png"],["b_disgust","./assets/imgs/disgust.png"]]})});const t=["exp2"];return e.push({component:a(C,{ques:H}),on_finish(n){t.push(`${m.instance.currTime}`),t.push(n.name),t.push(n.gender),t.push(n.idcard)}}),e.push({component:a(j,{model:!0})}),e.push({component(){return a(I,{pages:[Q,a(d,{img1:i.getAssets("b_happy"),img2:i.getAssets("h1-happy"),desc:"这个房子里的人正在一起吃冰淇淋，大家非常开心。"}),a(d,{img1:i.getAssets("b_fear"),img2:i.getAssets("h1-fear"),desc:"这个房子里的人看到窗外有一只狼，非常害怕。"}),a(d,{img1:i.getAssets("b_sad"),img2:i.getAssets("h1-sad"),desc:"这个房子里的人考试成绩不理想，感到很难过。"}),a(d,{img1:i.getAssets("b_disgust"),img2:i.getAssets("h1-disgust"),desc:"这个房子里的人看到变质的食物，感到非常厌恶。"}),a(d,{img1:i.getAssets("b_angry"),img2:i.getAssets("h1-angry"),desc:"这个房子里的人和同学发生了争吵，非常生气。"}),a(d,{img1:i.getAssets("b_surprise"),img2:i.getAssets("h1-surprise"),desc:"这个房子里的人听到了一声巨响，感到非常惊讶。"}),rs]})}}),e.push({timeline:[{component:a(I,{pages:[cs]})},{timeline:[{component(){return a(E,{stimulus:"+",stimulus_duration:500,trial_duration_time:1e3})}},{component(){const{face:n,bgs:r}=s.currTrial.parent.getAllTimelineVariables();return a(P,{mid:n,bgs:r})},on_finish(n){const{c_picture:r,response:o}=n,l=r.split("-")[1]===o.split("_")[1];n.prac=1,n.correct=l?1:0,console.log(n)}},{component(){const{correct:n}=s.data.get().last(1).values()[0];return a(E,{stimulus:n==1?"你选对了！":"再想一想",stimulus_duration:500,trial_duration_time:1e3})}}],timeline_variables:T,randomize_order:!0,trial_num:6}],loop_function(){const n=s.data.get().filter({trial_type:"drag-core"}).last(6).select("correct").mean();return!n||n<.8?(K.error("正确率过低, 重新练习"),!0):!1}}),e.push({component:a(I,{pages:[us]})}),e.push({timeline:[{component(){return a(E,{stimulus:"+",stimulus_duration:500,trial_duration_time:1e3})}},{component(){const{face:n,bgs:r}=s.currTrial.parent.getAllTimelineVariables();return a(P,{mid:n,bgs:r})},on_finish(n){const{c_picture:r,response:o}=n,l=r.split("-")[1]===o.split("_")[1];n.correct=l?1:0,n.prac=0}},{timeline:[{component:a(I,{pages:[a("p","休息一下吧")]})}],conditional_function(){const r=s.data.get().last(1).values()[0].trial_id.split("-").map(l=>l.split(".")),o=parseInt(r[1][2])+1;return o%30==0&&o>0}}],timeline_variables:T,randomize_order:!0}),e.push({component:a(j,{model:!1})}),e.push({component(){return a(M,{s3:{...N,bucket:"psydata",endpoint:"https://psy.mupsycho.com/oss",signEndpoint:"http://n1.jimoco.cn:29513",region:"cn",fileName:`lab-cas-23/exp2/${t.join("_")}.csv`}})}}),V(()=>{const n=document.querySelector("#exp");s.load(e,n)}),(n,r)=>(b(),y("div",gs))}}),bs=f(ds,[["__scopeId","data-v-bee0609f"]]);export{bs as default};
